<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>app/js/ttth/modules/userServiceConfigUpdater.js - ttth documentation</title>
    
    <meta name="description" content="a simple jsdoc based documentation for ttth" />
    
        <meta name="keywords" content="ttth" />
        <meta name="keyword" content="ttth" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="wrap">
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/yafp/ttth" target="_blank" class="menu-item" id="website_link" >github.com/yafp/ttth</a></h2><h3>Modules</h3><ul><li><a href="module-crashReporter.html">crashReporter</a></li><li><a href="module-sentry.html">sentry</a></li><li><a href="module-unhandled.html">unhandled</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-unhandled.html#~initUnhandled">initUnhandled</a></li></ul></li><li><a href="module-urlsGithub.html">urlsGithub</a></li><li><a href="module-userServiceConfigUpdater.html">userServiceConfigUpdater</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-userServiceConfigUpdater.html#~updateAllUserServiceConfigurations">updateAllUserServiceConfigurations</a></li><li data-type='method' style='display: none;'><a href="module-userServiceConfigUpdater.html#~updateAllUserServiceConfigurationsForM1M8P0">updateAllUserServiceConfigurationsForM1M8P0</a></li><li data-type='method' style='display: none;'><a href="module-userServiceConfigUpdater.html#~updateAllUserServiceConfigurationsForM1M9P0">updateAllUserServiceConfigurationsForM1M9P0</a></li><li data-type='method' style='display: none;'><a href="module-userServiceConfigUpdater.html#~updateAllUserServiceConfigurationsForM1M10P0">updateAllUserServiceConfigurationsForM1M10P0</a></li></ul></li><li><a href="module-utils.html">utils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-utils.html#~generateNewRandomServiceID">generateNewRandomServiceID</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#~getAppVersion">getAppVersion</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#~getDomain">getDomain</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#~getHostName">getHostName</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#~globalObjectGet">globalObjectGet</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#~globalObjectSet">globalObjectSet</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#~isLinux">isLinux</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#~isMac">isMac</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#~isWindows">isWindows</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#~jsonStoragePathSet">jsonStoragePathSet</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#~openURL">openURL</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#~showNoty">showNoty</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#~writeConsoleMsg">writeConsoleMsg</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="main.html">main</a><ul class='methods'><li data-type='method' style='display: none;'><a href="main.html#.checkNetworkConnectivity">checkNetworkConnectivity</a></li><li data-type='method' style='display: none;'><a href="main.html#.createMenu">createMenu</a></li><li data-type='method' style='display: none;'><a href="main.html#.createTray">createTray</a></li><li data-type='method' style='display: none;'><a href="main.html#.createWindow">createWindow</a></li><li data-type='method' style='display: none;'><a href="main.html#.createWindowConfig">createWindowConfig</a></li><li data-type='method' style='display: none;'><a href="main.html#.forceSingleAppInstance">forceSingleAppInstance</a></li><li data-type='method' style='display: none;'><a href="main.html#.showDialog">showDialog</a></li><li data-type='method' style='display: none;'><a href="main.html#.writeLog">writeLog</a></li></ul></li><li><a href="renderer.html">renderer</a><ul class='members'><li data-type='member' style='display: none;'><a href="renderer.html#.nextTab">nextTab</a></li><li data-type='member' style='display: none;'><a href="renderer.html#.openDevToolForCurrentService">openDevToolForCurrentService</a></li><li data-type='member' style='display: none;'><a href="renderer.html#.previousTab">previousTab</a></li><li data-type='member' style='display: none;'><a href="renderer.html#.reloadCurrentService">reloadCurrentService</a></li><li data-type='member' style='display: none;'><a href="renderer.html#.showSettings">showSettings</a></li><li data-type='member' style='display: none;'><a href="renderer.html#.startSearchUpdates">startSearchUpdates</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="renderer.html#.addServiceTab">addServiceTab</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.checkNetworkConnectivityPeriodic">checkNetworkConnectivityPeriodic</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.checkSupportedOperatingSystem">checkSupportedOperatingSystem</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.closeSingleServiceConfiguratationWindow">closeSingleServiceConfiguratationWindow</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.configureSingleUserService">configureSingleUserService</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.createSingleServiceConfiguration">createSingleServiceConfiguration</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.deleteConfiguredService">deleteConfiguredService</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.doAnimateServiceIcon">doAnimateServiceIcon</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.eventListenerForSingleService">eventListenerForSingleService</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.fontAwesomeShowIconGallery">fontAwesomeShowIconGallery</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.initAvailableServicesSelection">initAvailableServicesSelection</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.initSettingsPage">initSettingsPage</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.loadConfiguredUserServices">loadConfiguredUserServices</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.loadDefaultView">loadDefaultView</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.loadEnabledUserServices">loadEnabledUserServices</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.loadServiceSpecificCode">loadServiceSpecificCode</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.localizeUserInterface">localizeUserInterface</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.onMainWindowAfterReady">onMainWindowAfterReady</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.onMainWindowBeforeReady">onMainWindowBeforeReady</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.onMainWindowReady">onMainWindowReady</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.openDevTools">openDevTools</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.openReleasesOverview">openReleasesOverview</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.openUserServicesConfigFolder">openUserServicesConfigFolder</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.openUserSettingsConfigFolder">openUserSettingsConfigFolder</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.previewIcon">previewIcon</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.readLocalUserSetting">readLocalUserSetting</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.removeServiceTab">removeServiceTab</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.searchUpdate">searchUpdate</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.settingActivateUserColorCss">settingActivateUserColorCss</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.settingDefaultViewReset">settingDefaultViewReset</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.settingDefaultViewUpdate">settingDefaultViewUpdate</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.settingsSelectServiceToAddChanged">settingsSelectServiceToAddChanged</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.settingsToggleEnablePrereleases">settingsToggleEnablePrereleases</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.settingsToggleEnableStatusOfSingleUserService">settingsToggleEnableStatusOfSingleUserService</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.settingsToggleErrorReporting">settingsToggleErrorReporting</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.settingsUserAddNewService">settingsUserAddNewService</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.settingThemeReset">settingThemeReset</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.settingThemeUpdate">settingThemeUpdate</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.settingToggleAutostart">settingToggleAutostart</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.settingToggleDisableTray">settingToggleDisableTray</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.settingToggleUrgentWindow">settingToggleUrgentWindow</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.showNotyAutostartMinimizedConfirm">showNotyAutostartMinimizedConfirm</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.switchToService">switchToService</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.titlebarDispose">titlebarDispose</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.titlebarInit">titlebarInit</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.titlebarUpdateBackground">titlebarUpdateBackground</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.titlebarUpdateItemBackGroundOnHover">titlebarUpdateItemBackGroundOnHover</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.updateGlobalServicesShortcuts">updateGlobalServicesShortcuts</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.updateServiceBadge">updateServiceBadge</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.updateSingleServiceConfiguration">updateSingleServiceConfiguration</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.updateTrayIconStatus">updateTrayIconStatus</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.validateConfigSingleServiceForm">validateConfigSingleServiceForm</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.validateConfiguredDefaultView">validateConfiguredDefaultView</a></li><li data-type='method' style='display: none;'><a href="renderer.html#.writeLocalUserSetting">writeLocalUserSetting</a></li></ul></li><li><a href="services.html">services</a><ul class='methods'><li data-type='method' style='display: none;'><a href="services.html#.serviceDiscordGetAlertCount">serviceDiscordGetAlertCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceDiscordGetUnreadMessageCount">serviceDiscordGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceGitterGetUnreadMessageCount">serviceGitterGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceGoogleMailGetUnreadMessageCount">serviceGoogleMailGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceGoogleMessagesGetUnreadMessageCount">serviceGoogleMessagesGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceICQGetUnreadMessageCount">serviceICQGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceMattermostGetUnreadMessageCount">serviceMattermostGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceMessengerGetUnreadMessageCount">serviceMessengerGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceMicrosoftOffice365GetUnreadMessageCount">serviceMicrosoftOffice365GetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceMicrosoftOutlookGetUnreadMessageCount">serviceMicrosoftOutlookGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceMicrosoftTeamsGetUnreadMessageCount">serviceMicrosoftTeamsGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceRiotGetUnreadMessageCount">serviceRiotGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceSkypeGetUnreadMessageCount">serviceSkypeGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceSlackGetUnreadMessageCount">serviceSlackGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceSteamChatGetUnreadMessageCount">serviceSteamChatGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceTelegramGetUnreadMessageCount">serviceTelegramGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceThreemaGetUnreadMessageCount">serviceThreemaGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceTwitterGetUnreadMessageCount">serviceTwitterGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceWhatsAppGetUnreadMessageCount">serviceWhatsAppGetUnreadMessageCount</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceWhatsAppInit">serviceWhatsAppInit</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceWhatsAppRegister">serviceWhatsAppRegister</a></li><li data-type='method' style='display: none;'><a href="services.html#.serviceXingGetUnreadMessageCount">serviceXingGetUnreadMessageCount</a></li></ul></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">app/js/ttth/modules/userServiceConfigUpdater.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* @file userServiceConfigUpdater.js
* @fileOverview This module contains contains all functions to update the user service configurations after ttth updates
* @author yafp
* @module userServiceConfigUpdater
*/
'use strict'

const utils = require('./utils.js')

/**
* @function  updateAllUserServiceConfigurationsForM1M8P0
* @summary Patches the user service configration files on version changes if needed.
* @description Patches the user service configration files on version changes if needed.
*/
function updateAllUserServiceConfigurationsForM1M8P0 (callback) {
    // changes from 1.7.0 to 1.8.0:
    // - inject files got re-structured. Path &amp; names are stored in the user-services configuration files
    //
    const storage = require('electron-json-storage')
    utils.jsonStoragePathSet() // set default path

    utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurationsForM1M8P0 ::: Updating to 1.8.0')
    utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurationsForM1M8P0 ::: Starting to validate all existing user service configurations (reason: path of inject code files)')

    // loop over all json files - and see if we need to patch something
    storage.getAll(function (error, data) {
        if (error) {
            utils.writeConsoleMsg('error', 'updateAllUserServiceConfigurationsForM1M8P0 ::: Got error while trying to fetch all service configs. Error: ' + error)
            throw error
        }

        // show object which contains all config files
        // utils.writeConsoleMsg("info", "loadEnabledUserServices ::: Object: " + data);
        // console.error(data);

        let shouldConfigBeUpdated = false
        let newInjectCodePath = ''

        // loop over upper object
        for (const key in data) {
            // if (data.hasOwnProperty(key)) {
            utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurationsForM1M8P0 ::: Filename: _' + key + '_.')

            if (data[key].injectCode !== '') {
                switch (data[key].injectCode) {
                // gitter
                case './js/ttth/services/Gitter_inject.js':
                    newInjectCodePath = './js/ttth/services/gitter/gitter_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // googleMail
                case './js/ttth/services/GoogleMail_inject.js':
                    newInjectCodePath = './js/ttth/services/googleMail/googleMail_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // googleMessages
                case './js/ttth/services/GoogleMessages_inject.js':
                    newInjectCodePath = './js/ttth/services/googleMessages/googleMessages_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // icq
                case './js/ttth/services/ICQ_inject.js':
                    newInjectCodePath = './js/ttth/services/icq/icq_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // mattermost
                case './js/ttth/services/Mattermost_inject.js':
                    newInjectCodePath = './js/ttth/services/mattermost/mattermost_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // messenger
                case './js/ttth/services/Messenger_inject.js':
                    newInjectCodePath = './js/ttth/services/messenger/messenger_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // microsoftOffice365
                case './js/ttth/services/MicrosoftOffice365_inject.js':
                    newInjectCodePath = './js/ttth/services/microsoftOffice365/microsoftOffice365_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // microsoftOutlook
                case './js/ttth/services/MicrosoftOutlook_inject.js':
                    newInjectCodePath = './js/ttth/services/microsoftOoutlook/microsoftOutlook_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // microsoftTeams
                case './js/ttth/services/MicrosoftTeams_inject.js':
                    newInjectCodePath = './js/ttth/services/microsoftTeams/microsoftTeams_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // Riot
                case './js/ttth/services/Riot_inject.js':
                    newInjectCodePath = './js/ttth/services/riot/riot_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // skype
                case './js/ttth/services/Skype_inject.js':
                    newInjectCodePath = './js/ttth/services/skype/skype_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // slack
                case './js/ttth/services/Slack_inject.js':
                    newInjectCodePath = './js/ttth/services/slack/slack_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // steam
                case './js/ttth/services/SteamChat_inject.js':
                    newInjectCodePath = './js/ttth/services/steam/steam_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // telegram
                case './js/ttth/services/Telegram_inject.js':
                    newInjectCodePath = './js/ttth/services/telegram/telegram_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // threema
                case './js/ttth/services/Threema_inject.js':
                    newInjectCodePath = './js/ttth/services/threema/threema_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // twitter
                case './js/ttth/services/Twitter_inject.js':
                    newInjectCodePath = './js/ttth/services/twitter/twitter_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // whatsapp
                case './js/ttth/services/WhatsApp_inject.js':
                    newInjectCodePath = './js/ttth/services/whatsapp/whatsapp_inject.js'
                    shouldConfigBeUpdated = true
                    break

                    // xing
                case './js/ttth/services/Xing.js':
                    newInjectCodePath = './js/ttth/services/xing/xing_inject.js'
                    shouldConfigBeUpdated = true

                    break

                default:
                    utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurationsForM1M8P0 ::: Found no patch rule for ' + key + '. Skipping to next service configuration')
                    newInjectCodePath = ''
                    shouldConfigBeUpdated = false
                    break
                }
            }

            // Update this property - if needed
            if (shouldConfigBeUpdated === true) {
                utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurationsForM1M8P0 ::: Found patch rule for filename: _' + key + '_.')
                utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurationsForM1M8P0 ::: Starting to update: _' + key + '_ now.')

                storage.set(key,
                    {
                        type: data[key].type, // old value
                        name: data[key].name, // old value
                        icon: data[key].icon, // old value
                        url: data[key].url, // old value
                        injectCode: newInjectCodePath, // NEW VALUE
                        serviceEnableStatus: data[key].serviceEnableStatus // old value
                    }, function (error) {
                        if (error) {
                            utils.writeConsoleMsg('error', 'updateAllUserServiceConfigurationsForM1M8P0 ::: Error while trying to update a service configuration. Service: _' + key + '_. Error: ' + error)
                            utils.showNoty('error', 'Failed to update a user service configuration to 1.8.0 format. Error: ' + error)
                            throw error
                        }
                    })
            }
            // }
        }
        utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurationsForM1M8P0 ::: Finished.')

        // do the callback
        callback()
    })
}

/**
* @function  updateAllUserServiceConfigurationsForM1M9P0
* @summary Patches the user service configration files on version changes if needed.
* @description Patches the user service configration files on version changes if needed.
*/
function updateAllUserServiceConfigurationsForM1M9P0 (callback) {
    // 1.9.0 introduced userAgents per service. See #158
    // patch all user-services:
    // add: userAgentDefault
    // add: userAgentCustom
    const storage = require('electron-json-storage')
    utils.jsonStoragePathSet() // set default path

    utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurationsForM1M9P0 ::: Updating to 1.9.0')
    utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurationsForM1M9P0 ::: Starting to validate all existing user service configurations (reason: adding userAgentDefault and userAgentCustom)')

    // loop over all json files - and see if we need to patch something
    storage.getAll(function (error, data) {
        if (error) {
            utils.writeConsoleMsg('error', 'updateAllUserServiceConfigurationsForM1M9P0 ::: Got error while trying to fetch all service configs. Error: ' + error)
            throw error
        }

        // show object which contains all config files
        // utils.writeConsoleMsg("info", "loadEnabledUserServices ::: Object: " + data);
        // console.error(data);

        let userAgentDefaultMissing
        let newUserAgentDefaultString
        let userAgentCustomMissing
        let userUserAgentCustomString

        // loop over upper object
        //
        for (const key in data) {
            userAgentDefaultMissing = false
            newUserAgentDefaultString = ''
            userAgentCustomMissing = false
            userUserAgentCustomString = ''

            utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurationsForM1M9P0 ::: Current service configuration file: _' + key + '_.') // key = name of json file

            // ensure it is a service-config of ttth - which def. needs to have a type
            /*
            if (typeof data[key].type !== 'undefined') {
                // it is a service configuration

                if ((data[key].type.startsWith('google')) &amp;&amp; (data[key].userAgentDefault === '')) {
                    newUserAgentDefaultString = 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:70.0) Gecko/20100101 Firefox/70.0'
                    userAgentDefaultMissing = true
                }

                // service: whatsapp
                if ((data[key].type.startsWith('whatsapp')) &amp;&amp; (data[key].userAgentDefault === '')) {
                    newUserAgentDefaultString = 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:70.0) Gecko/20100101 Firefox/70.0'
                    userAgentDefaultMissing = true
                }

                // service: slack
                if ((data[key].type.startsWith('slack')) &amp;&amp; (data[key].userAgentDefault === '')) {
                    newUserAgentDefaultString = 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36'
                    userAgentDefaultMissing = true
                }

                // general: check if userAgentDefault exists
                if (data[key].userAgentDefault === undefined) {
                    utils.writeConsoleMsg('warn', 'updateAllUserServiceConfigurationsForM1M9P0 ::: Config for service type _' + data[key].type + '_ has no userAgentDefault yet.')
                    userAgentDefaultMissing = true
                }

                // general: check if userAgentCustom exists
                if (data[key].userAgentCustom === undefined) {
                    utils.writeConsoleMsg('warn', 'updateAllUserServiceConfigurationsForM1M9P0 ::: Config for service type _' + data[key].type + '_ has no userAgentCustom yet.')
                    userAgentCustomMissing = true
                }
            } else {
                utils.showNoty('error', 'Found unexpected service configuration file&lt;br>&lt;br>name: &lt;b>' + key + '&lt;/b>&lt;br>Please reload using CTRL+R&lt;br>&lt;br>Reference: #171', 0)
            }
            */

            if (data[key].hasOwnProperty('type')) { // it seems to be a ttth service configuration
                if ((data[key].type.startsWith('google')) &amp;&amp; (data[key].userAgentDefault === '')) {
                    newUserAgentDefaultString = 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:70.0) Gecko/20100101 Firefox/70.0'
                    userAgentDefaultMissing = true
                }

                // service: whatsapp
                if ((data[key].type.startsWith('whatsapp')) &amp;&amp; (data[key].userAgentDefault === '')) {
                    newUserAgentDefaultString = 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:70.0) Gecko/20100101 Firefox/70.0'
                    userAgentDefaultMissing = true
                }

                // service: slack
                if ((data[key].type.startsWith('slack')) &amp;&amp; (data[key].userAgentDefault === '')) {
                    newUserAgentDefaultString = 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36'
                    userAgentDefaultMissing = true
                }

                // general: check if userAgentDefault exists
                if (data[key].userAgentDefault === undefined) {
                    utils.writeConsoleMsg('warn', 'updateAllUserServiceConfigurationsForM1M9P0 ::: Config for service type _' + data[key].type + '_ has no userAgentDefault yet.')
                    userAgentDefaultMissing = true
                }

                // general: check if userAgentCustom exists
                if (data[key].userAgentCustom === undefined) {
                    utils.writeConsoleMsg('warn', 'updateAllUserServiceConfigurationsForM1M9P0 ::: Config for service type _' + data[key].type + '_ has no userAgentCustom yet.')
                    userAgentCustomMissing = true
                }
            } else {
                utils.writeConsoleMsg('error', 'updateAllUserServiceConfigurationsForM1M9P0 ::: File _' + key + '_ seems not to be a ttth service configuration (missing type).')
                utils.writeConsoleMsg('error', 'updateAllUserServiceConfigurationsForM1M9P0 ::: KeyData:', data[key])
                utils.showNoty('error', 'Found unexpected service configuration file&lt;br>&lt;br>name: &lt;b>' + key + '&lt;/b>&lt;br>Please reload ttth using CTRL+R&lt;br>&lt;br>Issue reference: #171', 0)
            }

            // update config if needed
            if ((userAgentDefaultMissing === true) || (userAgentCustomMissing === true)) {
                utils.writeConsoleMsg('warn', 'updateAllUserServiceConfigurationsForM1M9P0 ::: Updating config of service: _' + key + '_.')

                storage.set(key,
                    {
                        type: data[key].type, // old value
                        name: data[key].name, // old value
                        icon: data[key].icon, // old value
                        url: data[key].url, // old value
                        injectCode: data[key].injectCode, // NEW VALUE
                        serviceEnableStatus: data[key].serviceEnableStatus, // old value
                        userAgentDefault: newUserAgentDefaultString,
                        userAgentCustom: userUserAgentCustomString
                    }, function (error) {
                        if (error) {
                            utils.writeConsoleMsg('error', 'updateAllUserServiceConfigurationsForM1M9P0 ::: Error while trinyg to update a user service configuration. Error: ' + error)
                            utils.showNoty('error', 'Failed to update a user service configuration to 1.9.0 format. Error: ' + error)
                            throw error
                        }
                    })
            } else {
                utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurationsForM1M9P0 ::: Configuration of service: _' + key + '_ looks good. No need to update it.')
            }
        }
        utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurationsForM1M9P0 ::: Finished.')

        // do the callback
        callback()
    })
}

/**
* @function  updateAllUserServiceConfigurationsForM1M10P0
* @summary Patches the user service configration files ...
* @description Patches the user service configration files ...
*/
function updateAllUserServiceConfigurationsForM1M10P0 (callback) {
    // do the callback
    callback()
}

/**
* @function updateAllUserServiceConfigurations
* @summary Patches the user service configration files on version changes if needed.
* @description Patches the user service configration files on version changes if needed.
*/
function updateAllUserServiceConfigurations () {
    const localAppVersion = utils.getAppVersion()
    utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurations ::: Detected ttth version: ' + localAppVersion)
    utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurations ::: Gonna start now to update the local defined service configurations for eac hnew released version. This might take some time...')

    /*
    // Previously:
    // Problem: both functions did run parallel - might cause file-blocking
    updateAllUserServiceConfigurationsForM1M8P0() // updates needed for 1.8.0
    updateAllUserServiceConfigurationsForM1M9P0() // updates needed for 1.9.0
    */

    updateAllUserServiceConfigurationsForM1M8P0(function () {
        updateAllUserServiceConfigurationsForM1M9P0(function () {
            updateAllUserServiceConfigurationsForM1M10P0(function () {
                // All three functions have completed, in order.
                utils.writeConsoleMsg('info', 'updateAllUserServiceConfigurations ::: Finiushed updating all user service configurations')
            })
        })
    })
}

// Export the functions
//
module.exports.updateAllUserServiceConfigurations = updateAllUserServiceConfigurations
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Sat Mar 13 2021 22:19:26 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
